<!DOCTYPE html>
<html>
<head>
	<title>Car Racing</title>
	<meta charset="utf-8">
</head>
<body onload="work()">
<script>
	var driven,
		imageArr = ['enemy1.jpg','enemy2.png','enemy3.jpg','enemy4.jpg','enemy5.jpg','enemy6.jpg','enemy7.jpg'],
		enemies = [],
		lanes = [],
		 enemiesMove;
function work(){
		driven = new Component(200,520,100,100,'image',0,'car.jpg');
		//enemy = new Component(200,0,100,100,'image','enemy1.jpg');
		gameArea.start();
	}

	var gameArea = {
		canvas: document.createElement('canvas'),
		start: function(){
			this.canvas.width = 600;
			this.canvas.height = 630;
			this.canvas.style.background = 'transparent';
			this.canvas.style.border = 'solid 2px #555';
			this.context = this.canvas.getContext('2d');
			document.body.insertBefore(this.canvas,document.body.childNodes[0]);
			this.frameNo = 0;
			this.interval = setInterval(updateOthers,20);
			window.addEventListener('keydown', function(e){
				e.preventDefault();
				gameArea.keys = (gameArea.keys || []);
				gameArea.keys[e.keyCode] = true;
			})
			window.addEventListener('keyup', function(e){
				e.preventDefault();
				gameArea.keys[e.keyCode] = false;
			})
		},
		clean: function(){
			this.context.clearRect(0,0,this.canvas.width,this.canvas.height);
		},
		stop: function(){
			clearInterval(this.interval);
		}
	}

	var Component = function (x,y,width,height,type,speed,source){
		this.type = type;
		this.x = x;
		this.y = y;
		this.speed = speed;
		console.log(this.y,this.speed);
		this.speedX = 0;
		this.speedY = 0;
		this.width = width;
		this.height = height;
		this.gravity = 0;
		this.gravitySpeed = 0;
		this.getImage = function(){
			ctx = gameArea.context;
			if(this.type == 'image'){
				this.image = new Image();
				this.image.src = source;
				ctx.drawImage(this.image,this.x,this.y,this.width,this.height)
			}
			
		}
		this.carSpeed = function(){
			this.y += this.speed;
		}
		this.changePos = function(){
			this.gravitySpeed += this.gravity;
			this.x += this.speedX;
			this.y += this.speedY + this.gravitySpeed;
			this.hitbottom();
		}
		this.hitbottom = function(){
			let top = gameArea.canvas.height - 630;
			let bottom = gameArea.canvas.height - this.height;
			let rightSide = gameArea.canvas.width - this.width - 50;
			let leftSide = gameArea.canvas.width - 550;
			if(this.y < top){
				this.y = top;
			}
			if(this.y > bottom){
				this.y = bottom;
				this.gravitySpeed = 0;
			}
			if(this.x > rightSide){
				this.x = rightSide;
			}
			if(this.x < leftSide){
				this.x = leftSide;
			}
		}
		this.createRect = function (){
			let ctx = gameArea.context;
			ctx.fillStyle = '#fff';
			ctx.fillRect(this.x, this.y, this.width,this.height);
		}
		this.crash = function(anotherObj){
			let drivenLeft = this.x;
			let drivenRight = this.x + this.width;
			let drivenTop = this.y;
			let drivenBottom = this.y + this.height;
			let otherLeft = anotherObj.x
			let otherRight = anotherObj.x + anotherObj.width;
			let otherTop = anotherObj.y; 
			let otherBottom = anotherObj.y + anotherObj.height;
			let crash = true;
			if((drivenBottom < otherTop) ||(drivenTop > otherBottom) || (drivenRight < otherLeft) || (drivenLeft > otherRight)){
				crash = false
			}
			return crash;
		}
		this.score = function(text){
			ctx = gameArea.context;
			ctx.font = '20px lcd';
			ctx.fillText(text, 10, 30);
			ctx.fillStyle = '#fff';
		}
	}

	function updateOthers(){
		var rand, max, min, randEnemyAttack, rect, randSpeed;
		gameArea.frameNo += 1;
		gameArea.clean();
		lane();
		if(gameArea.frameNo % 30 == 0){
		rect = new Component(gameArea.canvas.width/2 - 10,-50,20,50);
		lanes.push(rect);
	}
	for(var i = 0;i < lanes.length; i++){
			lanes[i].createRect();
			lanes[i].y += 3; 
		}
		max = 450;
		min = 50;
		//randEnemyAttack = Math.floor(Math.random() *2000);
		if(gameArea.frameNo == 1 || gameArea.frameNo % 120 == 0){
			randSpeed = Math.floor(Math.random()*4)+ 2;
			randPosX = Math.floor(Math.random()*(max-min+1)) + min
			rand = Math.floor(Math.random()*7);
			enemies.push(new Component(randPosX,-100,100,100,'image',randSpeed,imageArr[rand]));
			console.log(enemies,enemies.length);
		//console.log(randEnemyAttack);
		//enemy.y += 1;
	}
		for(var i = 0; i < enemies.length; i++){
			enemies[i].carSpeed();
			//enemies[i].y += 2;
			enemies[i].getImage();
			if(driven.crash(enemies[i])){
		gameArea.stop();
		alert("GAME OVER!")
		}
		enemies[i].score('Score: ' +enemies.length * 10);
		}	
		driven.speedX = 0;
		driven.speedY = 0;
		if(gameArea.keys && gameArea.keys[37]) driven.speedX = -4;
		if(gameArea.keys && gameArea.keys[39]) driven.speedX = 4;
		if(gameArea.keys && gameArea.keys[38]) driven.speedY = -4;
		if(gameArea.keys && gameArea.keys[40]) driven.speedY = 4;
		// enemiesMove.getImage();
		// enemiesMove.changePos();
		driven.changePos();
		driven.getImage();
		//enemy.getImage();
	}

	function everyinterval(n){
		if((gameArea.frameNo / n ) % 1 == 0){return true;}
		return false;
	}
	function lane(){
		ctx = gameArea.context;
		ctx.fillStyle = '#222';
		ctx.fillRect(50,0,500,gameArea.canvas.height );
		ctx.fillStyle = '#17A05D';
		ctx.fillRect(0,0,50,gameArea.canvas.height);
		ctx.fillRect(550,0,50,gameArea.canvas.height);
		// for(var i = 0; i < 8; i++){
		// 	ctx.fillStyle = '#fff';
		// 	ctx.fillRect(gameArea.canvas.width/2 - 10,80*i,20,50);
		// }


	}
</script>
</body>
</html>