<!DOCTYPE html>
<html>
<head>
	<title>Car Racing</title>
	<meta charset="utf-8">
</head>
<body onload="work()">
<script>
	var driven,
		imageArr = ['enemy1.jpg','enemy2.png','enemy3.jpg','enemy4.jpg','enemy5.jpg','enemy6.jpg','enemy7.jpg'],
		enemies = [],
		 enemiesMove;
function work(){
		driven = new Component(200,520,100,100,'image','car.jpg');
		enemy = new Component(200,0,100,100,'image','enemy1.jpg');
		gameArea.start();
	}

	var gameArea = {
		canvas: document.createElement('canvas'),
		start: function(){
			this.canvas.width = 500;
			this.canvas.height = 630;
			this.canvas.style.background = 'transparent';
			this.canvas.style.border = 'solid 2px #555';
			this.context = this.canvas.getContext('2d');
			document.body.insertBefore(this.canvas,document.body.childNodes[0]);
			this.frameNo = 0;
			this.interval = setInterval(updateOthers,20);
			window.addEventListener('keydown', function(e){
				e.preventDefault();
				gameArea.keys = (gameArea.keys || []);
				gameArea.keys[e.keyCode] = true;
			})
			window.addEventListener('keyup', function(e){
				e.preventDefault();
				gameArea.keys[e.keyCode] = false;
			})
		},
		clean: function(){
			this.context.clearRect(0,0,this.canvas.width,this.canvas.height);
		},
		stop: function(){
			clearInterval(this.interval);
		}
	}

	var Component = function (x,y,width,height,type,source){
		this.type = type;
		this.x = x;
		this.y = y;
		this.speedX = 0;
		this.speedY = 0;
		this.width = width;
		this.height = height;
		this.getImage = function(){
			ctx = gameArea.context;
			if(this.type == 'image'){
				this.image = new Image();
				this.image.src = source;
				ctx.drawImage(this.image,this.x,this.y,this.width,this.height)
			}
			
		}
		this.changePos = function(){
			this.x += this.speedX;
			this.y += this.speedY;
		}
		this.crash = function(anotherObj){
			let drivenLeft = this.x;
			let drivenRight = this.x + this.width;
			let drivenTop = this.y;
			let drivenBottom = this.y + this.height;
			let otherLeft = anotherObj.x
			let otherRight = anotherObj.x + anotherObj.width;
			let otherTop = anotherObj.y; 
			let otherBottom = anotherObj.y + anotherObj.height;
			let crash = true;
			if((drivenBottom < otherTop) ||(drivenTop > otherBottom) || (drivenRight < otherLeft) || (drivenLeft > otherRight)){
				crash = false
			}
			return crash;
		}
		this.score = function(text){
			ctx = gameArea.context;
			ctx.font = '20px Arial';
			ctx.fillText(text, 10, 30);
			ctx.fillStyle = '#3bcdde';
		}
	}

	function updateOthers(){
		var rand
		gameArea.frameNo += 1;
		gameArea.clean();
		lane();
		if(gameArea.frameNo == 1 || gameArea.frameNo % 250 == 0){
			randPosX = Math.floor(Math.random()*400)
			rand = Math.floor(Math.random()*7);
			enemies.push(new Component(randPosX,-100,100,100,'image',imageArr[rand]));
			console.log(enemies,enemies.length);
		
		// if(driven.crash(enemies[rand])){
		// gameArea.stop();
		// alert("GAME OVER!")
		// }
		//enemy.y += 1;
	}
		for(var i = 0; i < enemies.length; i++){
			enemies[i].y += 1;
			enemies[i].getImage();
			if(driven.crash(enemies[i])){
		gameArea.stop();
		alert("GAME OVER!")
		}
		enemies[i].score(enemies.length * 10);
		}	
		//console.log(enemies[i].y);
		driven.speedX = 0;
		driven.speedY = 0;
		if(gameArea.keys && gameArea.keys[37]) driven.speedX = -3;
		if(gameArea.keys && gameArea.keys[39]) driven.speedX = 3;
		if(gameArea.keys && gameArea.keys[38]) driven.speedY = -3;
		if(gameArea.keys && gameArea.keys[40]) driven.speedY = 3;
		// enemiesMove.getImage();
		// enemiesMove.changePos();
		driven.changePos();
		driven.getImage();
		//enemy.getImage();
	}

	function everyinterval(n){
		if((gameArea.frameNo / n ) % 1 == 0){return true;}
		return false;
	}
	function lane(){
		ctx = gameArea.context;
		ctx.fillStyle = '#000';
		ctx.fillRect(50,0,400,gameArea.canvas.height);
		ctx.fillStyle = '#17A05D';
		ctx.fillRect(0,0,50,gameArea.canvas.height);
		ctx.fillRect(450,0,50,gameArea.canvas.height);
	}
</script>
</body>
</html>